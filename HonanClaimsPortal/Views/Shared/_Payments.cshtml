
<style>
    .PaymentDetail_{

        max-height: 90vh;
}
</style>

<div class="panel panel-default">

    <div class="panel-body">

        <div class="col-md-12" style="padding-left:0px">
            <div class="col-md-12" style="padding-left:0px">
                <div class="col-md-8">
                    <div class="input-group">

                    </div>
                </div>
                <div class="col-md-4">
                    <input type="button" value="New Payment" id="btnNewPayment" class="btn btn-primary pull-right" data-toggle="modal" data-target="#PaymentDetailModal" />
                </div>


            </div>
        </div>
        <br /><br /><br />
        <div id="gridPaymentDetails"></div>

    </div>
</div>

<!-- Modal -->
<div id="PaymentDetailModal" class="modal fade PaymentDetailModal" role="dialog" data-backdrop="true">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Payment Detail</h4>
            </div>
            <div class="modal-body PaymentDetail_">
                @{Html.RenderAction("_PaymentDetail", "ClaimDetailTabs", new { claimId = this.ViewData["claimId"], Claim_Reference_Num = this.ViewData["Claim_Reference_Num"] });}

            </div>
           
        </div>
    </div>
</div>

<script>

    function RefreshPaymentDetailsGrid() {
        $("#gridPaymentDetails").data("kendoGrid").dataSource.read({
            payeeId: '', invoicedDate: '', status: '', invoiceNo: ''
        });
    }
    //string claimId, string payeeId, string invoicedDate, string status, string invoiceNo
    $(function () {

        $("#gridPaymentDetails").kendoGrid({

            dataSource: {
                transport: {
                    //read: "/ClaimDetailTabs/AjaxAttachmentsLoad?claimId=" + $("#H_Claimsid").val() + "&searchText=" + $("#AttachmentsearchTxt").val(),
                    read: "/ClaimDetailTabs/AjaxPaymentDetailsLoad?claimId=" + $("#H_Claimsid").val(),
                },
                pageSize: 100,
                parameterMap: function (options, operation) {
                    if (operation !== "read" && options.models) {
                        return { models: kendo.stringify(options.models) };
                    }
                },
                batch: false,
            },
            filterable: true,
            pageSize: 100,
            navigatable: true,
            pageable: true,
            sortable: true,
            columns: [

                {
                    field: "Date_Invoice_Received",
                    title: "Date Received",
                    template: "<a  href='javascript:void(0);' onclick=\"loadPaymentDetail('#= H_Paymentsid #')\" '>#=Date_Invoice_Received#</a>"
                },
                {
                    field: "Invoice_Reference",
                    title: "Invoice Ref"
                },
                {
                    field: "Payee",
                    title: "Payee"
                },
                {
                    field: "Total_Gross",
                    title: "Total Gross"
                },
                {
                    field: "Total_Net",
                    title: "Total Net"
                },
                {
                    field: "Payment_Status",
                    title: "Payment Status"
                }
            ]
        });
    });


    function loadPaymentDetail(detailId)
    {
        $.ajax({
            url: "/ClaimDetailTabs/getFuleNoteById?fileNoteId=" + fileNoteId, success: function (result) {

                $("#CreatedBy_Id_Fn").val(result.CreatedUserId);
                $("#ClaimId_Fn").val(result.H_ClaimsId);
                $("#ClaimRefNo_Fn").val(result.ClaimRefNum);
                $("#FileNoteDate_Fn").val(result.FileNoteDate);
                $("#CreatedBy_Fn").val(result.CreatedUser);
                $("#CreatedDate_Fn").val(result.CreatedDate);

                $("#ShortDescription_Fn").val(result.ShortDescription);
                $("#Detail_Fn").val(result.Details);
                $("#H_FileNotesId_Fn").val(result.H_FileNotesId);

                $('#FileNoteDetailModal').modal('show');
            }
        });
    }

</script>